<!DOCTYPE html>
<html>
    <head>
        <title>PREDICT'IF - Mediums</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <!-- Librairie Javascript: jQuery (v3.4.1) -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    </head>
    <body>
        <h1>- Nos médiums -<span id="idClient"></span></h1> 
        <p id="notification"></p>
        <div class="medium1"></div>
        <div class="medium2"><span id="medium2"></span></div>
        <div class="medium3"><span id="medium3"></span></div>
        <div class="medium4"><span id="medium4"></span></div>
        <div class="medium5"><span id="medium5"></span></div> 
        <div class="medium6"><span id="medium6"></span></div>


        <script>
            function initSession() {
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        todo: 'clientConnecte'
                    },
                    dataType: 'json'
                })
                        .done(function (response) { // Fonction appelée en cas d'appel AJAX réussi
                            client = response.utilisateur;
                            console.log('ID du client connecté:', client.id);
                        });
                //var idClient = (new URLSearchParams(window.location.search)).get('id');

            }
            function initMediums() {
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        todo: 'listeMediums'
                    },
                    dataType: 'json'
                })
                        .done(function (response) { // Fonction appelée en cas d'appel AJAX réussi
                            //$('#medium1').html(response.medium1.denomination);
                            let infosSupplementaires = "";
                            if (response.medium1.type == "Spirite") {
                                infosSupplementaires = (
                                        '<p id="support">Support : ' + response.medium1.support + '</p>'
                                        );
                            } else if (response.medium1.type == "Astrologue") {
                                infosSupplementaires = (
                                        '<p id="formation">Formation : ' + response.medium1.formation + '</p>' +
                                        '<p id="promotion">Promotion : ' + response.medium1.promotion + '</p>'
                                        );
                            }
                            $('.medium1').append(
                                    '<p id="denomination">' + response.medium1.denomination + '</p>' +
                                    '<p id="genre">' + response.medium1.genre + '</p>' +
                                    '<p id="type">' + response.medium1.type + '</p>' +
                                    '<p id="presentation">' + response.medium1.presentation + '</p>' +
                                    infosSupplementaires +
                                    '<button class="bouton" id="' + response.medium1.denomination + '" onClick="boutonDemandeConsultation(this.id)">PRENDRE RDV</button>' + '<hr>'
                                    );

                            infosSupplementaires = "";
                            if (response.medium2.type == "Spirite") {
                                infosSupplementaires = (
                                        '<p id="support">Support : ' + response.medium2.support + '</p>'
                                        );
                            } else if (response.medium2.type == "Astrologue") {
                                infosSupplementaires = (
                                        '<p id="formation">Formation : ' + response.medium2.formation + '</p>' +
                                        '<p id="promotion">Promotion : ' + response.medium2.promotion + '</p>'
                                        );
                            }
                            $('.medium2').append(
                                    '<p id="denomination">' + response.medium2.denomination + '</p>' +
                                    '<p id="genre">' + response.medium2.genre + '</p>' +
                                    '<p id="type">' + response.medium2.type + '</p>' +
                                    '<p id="presentation">' + response.medium2.presentation + '</p>' +
                                    infosSupplementaires +
                                    '<button class="bouton" id="' + response.medium2.denomination + '" onClick="boutonDemandeConsultation(this.id)">PRENDRE RDV</button>' + '<hr>'
                                    );

                            infosSupplementaires = "";
                            if (response.medium3.type == "Spirite") {
                                infosSupplementaires = (
                                        '<p id="support">Support : ' + response.medium3.support + '</p>'
                                        );
                            } else if (response.medium3.type == "Astrologue") {
                                infosSupplementaires = (
                                        '<p id="formation">Formation : ' + response.medium3.formation + '</p>' +
                                        '<p id="promotion">Promotion : ' + response.medium3.promotion + '</p>'
                                        );
                            }
                            $('.medium3').append(
                                    '<p id="denomination">' + response.medium3.denomination + '</p>' +
                                    '<p id="genre">' + response.medium3.genre + '</p>' +
                                    '<p id="type">' + response.medium3.type + '</p>' +
                                    '<p id="presentation">' + response.medium3.presentation + '</p>' +
                                    infosSupplementaires +
                                    '<button class="bouton" id="' + response.medium3.denomination + '" onClick="boutonDemandeConsultation(this.id)">PRENDRE RDV</button>' + '<hr>'
                                    );

                            infosSupplementaires = "";
                            if (response.medium4.type == "Spirite") {
                                infosSupplementaires = (
                                        '<p id="support">Support : ' + response.medium4.support + '</p>'
                                        );
                            } else if (response.medium4.type == "Astrologue") {
                                infosSupplementaires = (
                                        '<p id="formation">Formation : ' + response.medium4.formation + '</p>' +
                                        '<p id="promotion">Promotion : ' + response.medium4.promotion + '</p>'
                                        );
                            }
                            $('.medium4').append(
                                    '<p id="denomination">' + response.medium4.denomination + '</p>' +
                                    '<p id="genre">' + response.medium4.genre + '</p>' +
                                    '<p id="type">' + response.medium4.type + '</p>' +
                                    '<p id="presentation">' + response.medium4.presentation + '</p>' +
                                    infosSupplementaires +
                                    '<button class="bouton" id="' + response.medium4.denomination + '" onClick="boutonDemandeConsultation(this.id)">PRENDRE RDV</button>' + '<hr>'
                                    );

                            infosSupplementaires = "";
                            if (response.medium5.type == "Spirite") {
                                infosSupplementaires = (
                                        '<p id="support">Support : ' + response.medium5.support + '</p>'
                                        );
                            } else if (response.medium5.type == "Astrologue") {
                                infosSupplementaires = (
                                        '<p id="formation">Formation : ' + response.medium5.formation + '</p>' +
                                        '<p id="promotion">Promotion : ' + response.medium5.promotion + '</p>'
                                        );
                            }
                            $('.medium5').append(
                                    '<p id="denomination">' + response.medium5.denomination + '</p>' +
                                    '<p id="genre">' + response.medium5.genre + '</p>' +
                                    '<p id="type">' + response.medium5.type + '</p>' +
                                    '<p id="presentation">' + response.medium5.presentation + '</p>' +
                                    infosSupplementaires +
                                    '<button class="bouton" id="' + response.medium5.denomination + '" onClick="boutonDemandeConsultation(this.id)">PRENDRE RDV</button>' + '<hr>'
                                    );

                            infosSupplementaires = "";
                            if (response.medium6.type == "Spirite") {
                                infosSupplementaires = (
                                        '<p id="support">Support : ' + response.medium6.support + '</p>'
                                        );
                            } else if (response.medium6.type == "Astrologue") {
                                infosSupplementaires = (
                                        '<p id="formation">Formation : ' + response.medium6.formation + '</p>' +
                                        '<p id="promotion">Promotion : ' + response.medium6.promotion + '</p>'
                                        );
                            }
                            $('.medium6').append(
                                    '<p id="denomination">' + response.medium6.denomination + '</p>' +
                                    '<p id="genre">' + response.medium6.genre + '</p>' +
                                    '<p id="type">' + response.medium6.type + '</p>' +
                                    '<p id="presentation">' + response.medium6.presentation + '</p>' +
                                    infosSupplementaires +
                                    '<button class="bouton" id="' + response.medium6.denomination + '" onClick="boutonDemandeConsultation(this.id)">PRENDRE RDV</button>' + '<hr>'
                                    );


                            console.log('Fin liste des mediums: ', response);
                        })
                //var idClient = (new URLSearchParams(window.location.search)).get('id');


            }

            $(document).ready(function () {
                initSession();
                initMediums();
            });


            function boutonDemandeConsultation(denomination) {
                console.log(denomination);
                $('#notification').html("Demande en cours...");
                // Appel AJAX
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        todo: 'demandeConsultation',
                        denominationMedium: denomination,
                    },
                    dataType: 'json'
                })
                        .done(function (response) { // Fonction appelée en cas d'appel AJAX réussi
                            console.log('Response', response); // LOG dans Console Javascript
                            if (response.reussite) {
                                $('#notification').html("Demande OK");  // Message pour le paragraphe de notification
                            } else {
                                $('#notification').html("Erreur dans la demande");
                            }
                        })
                        .fail(function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                            console.log('Error demande consultation', error); // LOG dans Console Javascript
                            alert("Erreur lors de l'appel AJAX");
                        })
                        .always(function () { // Fonction toujours appelée

                        });
            }

        </script>
    </body>
</html>
